<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>几何禅意 | Zen Shapes</title>
    <style>
        :root { --primary: #ffffff; }
        body {
            margin: 0;
            overflow: hidden;
            background: #fdf6e3; /* 纸质感底色 */
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            transition: background 2s ease;
        }
        canvas { display: block; }
        #ui {
            position: absolute;
            top: 40px;
            width: 100%;
            text-align: center;
            pointer-events: none;
        }
        .score-label {
            font-size: 14px;
            letter-spacing: 4px;
            color: rgba(0,0,0,0.4);
            text-transform: uppercase;
        }
        #score {
            font-size: 64px;
            font-weight: 200;
            color: rgba(0,0,0,0.7);
            margin-top: -10px;
        }
        #game-over {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            z-index: 10;
        }
        h1 { font-weight: 300; letter-spacing: 10px; color: #333; }
        .btn {
            margin-top: 30px;
            padding: 12px 40px;
            border: 1px solid #333;
            background: none;
            cursor: pointer;
            font-size: 14px;
            letter-spacing: 2px;
            transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
        }
        .btn:hover {
            background: #333;
            color: #fff;
            transform: translateY(-2px);
        }
    </style>
</head>
<body>

    <div id="ui">
        <div class="score-label">当前意境</div>
        <div id="score">0</div>
    </div>

    <div id="game-over">
        <h1>万物归寂</h1>
        <p>最终意境: <span id="final-score">0</span></p>
        <button class="btn" onclick="resetGame()">再次启程</button>
    </div>

    <canvas id="canvas"></canvas>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const scoreEl = document.getElementById('score');
const gameOverEl = document.getElementById('game-over');

let score = 0;
let gameActive = true;
let shapes = [];
let particles = [];
let hue = 40; 

const player = {
    x: window.innerWidth / 2,
    y: window.innerHeight / 2,
    size: 20,
    targetX: window.innerWidth / 2,
    targetY: window.innerHeight / 2,
    color: '#333'
};

function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

window.addEventListener('mousemove', e => {
    player.targetX = e.clientX;
    player.targetY = e.clientY;
});

class Shape {
    constructor() {
        this.init();
    }
    init() {
        const side = Math.floor(Math.random() * 4);
        if(side === 0) { this.x = Math.random()*canvas.width; this.y = -50; }
        else if(side === 1) { this.x = canvas.width + 50; this.y = Math.random()*canvas.height; }
        else if(side === 2) { this.x = Math.random()*canvas.width; this.y = canvas.height + 50; }
        else { this.x = -50; this.y = Math.random()*canvas.height; }

        const angle = Math.atan2(player.y - this.y, player.x - this.x);
        const speed = 1.5 + (score / 1000);
        this.vx = Math.cos(angle) * speed;
        this.vy = Math.sin(angle) * speed;
        this.size = Math.random() * 15 + 10;
        this.rotation = 0;
        this.rotSpeed = (Math.random() - 0.5) * 0.05;
        this.type = Math.random() > 0.5 ? 'rect' : 'poly';
    }
    update() {
        this.x += this.vx;
        this.y += this.vy;
        this.rotation += this.rotSpeed;
    }
    draw() {
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.rotate(this.rotation);
        ctx.fillStyle = 'rgba(0,0,0,0.15)';
        if(this.type === 'rect') {
            ctx.fillRect(-this.size/2, -this.size/2, this.size, this.size);
        } else {
            ctx.beginPath();
            for(let i=0; i<3; i++) {
                ctx.lineTo(Math.cos(i*Math.PI*2/3)*this.size, Math.sin(i*Math.PI*2/3)*this.size);
            }
            ctx.closePath();
            ctx.fill();
        }
        ctx.restore();
    }
}

class Fragment {
    constructor(x, y) {
        this.x = x;
        this.y = y;
        this.vx = (Math.random() - 0.5) * 4;
        this.vy = (Math.random() - 0.5) * 4;
        this.life = 1.0;
    }
    draw() {
        ctx.fillStyle = `rgba(0,0,0,${this.life * 0.3})`;
        ctx.beginPath();
        ctx.arc(this.x, this.y, 2, 0, Math.PI*2);
        ctx.fill();
        this.x += this.vx;
        this.y += this.vy;
        this.life -= 0.02;
    }
}

function updateColors() {
    hue = (hue + 0.1) % 360;
    document.body.style.background = `hsl(${hue}, 30%, 92%)`;
}

function resetGame() {
    score = 0;
    shapes = [];
    particles = [];
    gameActive = true;
    gameOverEl.style.display = 'flex'; // 先显示一下
    gameOverEl.style.display = 'none';
    scoreEl.innerText = score;
    animate();
}

function animate() {
    if(!gameActive) return;
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    updateColors();

    player.x += (player.targetX - player.x) * 0.1;
    player.y += (player.targetY - player.y) * 0.1;

    ctx.fillStyle = player.color;
    ctx.beginPath();
    ctx.arc(player.x, player.y, player.size/2, 0, Math.PI*2);
    ctx.fill();

    ctx.strokeStyle = 'rgba(0,0,0,0.1)';
    ctx.beginPath();
    ctx.arc(player.x, player.y, player.size * 1.5, 0, Math.PI*2);
    ctx.stroke();

    particles.forEach((p, i) => {
        p.draw();
        if(p.life <= 0) particles.splice(i, 1);
    });

    if(Math.random() < 0.05) shapes.push(new Shape());

    shapes.forEach((s, i) => {
        s.update();
        s.draw();

        const dist = Math.hypot(player.x - s.x, player.y - s.y);
        if(dist < player.size/2 + s.size/2) {
            gameActive = false;
            for(let j=0; j<15; j++) particles.push(new Fragment(player.x, player.y));
            gameOverEl.style.display = 'flex';
            document.getElementById('final-score').innerText = score;
        }

        if(s.x < -60 || s.x > canvas.width+60 || s.y < -60 || s.y > canvas.height+60) {
            shapes.splice(i, 1);
            score++;
            scoreEl.innerText = score;
        }
    });

    requestAnimationFrame(animate);
}

animate();
</script>
</body>
</html>